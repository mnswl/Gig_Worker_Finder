{"version":3,"file":"static/js/30.55df0f93.chunk.js","mappings":"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","sources":["pages/TwoFactor.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../api';\r\n\r\nfunction TwoFactor() {\r\n  const navigate = useNavigate();\r\n  const [phone, setPhone] = useState('');\r\n  const [phoneSent, setPhoneSent] = useState(false);\r\n  const [phoneCode, setPhoneCode] = useState('');\r\n  const [phoneVerified, setPhoneVerified] = useState(false);\r\n  const [msg, setMsg] = useState('');\r\n\r\n  // Enter key behavior\r\n  useEffect(()=>{\r\n    const onKey=(e)=>{\r\n      if(e.key!=='Enter') return;\r\n      if(!phoneSent){\r\n        if(phone) sendPhoneCode();\r\n      } else if(phoneSent && !phoneVerified){\r\n        if(phoneCode.length===6) verifyPhone();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', onKey);\r\n    return ()=> window.removeEventListener('keydown', onKey);\r\n  }, [phone, phoneSent, phoneCode, phoneVerified]);\r\n\r\n  const sendPhoneCode = async () => {\r\n    if (!phone) return;\r\n    try {\r\n      // Save phone to user profile first (required by backend)\r\n      await api.patch('/auth/me', { phone });\r\n      await api.post('/auth/phone-code', { phone });\r\n      setPhoneSent(true);\r\n      setMsg('Verification code sent via SMS');\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMsg(err.response?.data?.msg || 'Failed to send phone code');\r\n    }\r\n  };\r\n\r\n  const verifyPhone = async () => {\r\n    try {\r\n      await api.post('/auth/verify-phone', { phone, code: phoneCode });\r\n      setPhoneVerified(true);\r\n      setMsg('Phone verified successfully');\r\n      // update user phone in DB is already verified by controller\r\n      navigate('/dashboard');\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMsg(err.response?.data?.msg || 'Verification failed');\r\n    }\r\n  };\r\n\r\n  const skip = async () => {\r\n    try {\r\n      if (phone && !phoneVerified) {\r\n        // remove phone from DB\r\n        await api.patch('/auth/me', { phone: '' });\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n    } finally {\r\n      navigate('/dashboard');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container py-5\" style={{maxWidth: 500}}>\r\n      <h2 className=\"mb-3\">Set up Two-Factor Authentication</h2>\r\n      <p className=\"text-muted\">For additional security you can verify a phone number now. You may also skip and do this later.</p>\r\n\r\n      {msg && <div className=\"alert alert-info\">{msg}</div>}\r\n\r\n      <div className=\"card card-body\">\r\n        <label className=\"form-label\">Phone Number</label>\r\n        <input type=\"text\" className=\"form-control mb-2\" value={phone} onChange={e=>setPhone(e.target.value)} placeholder=\"e.g. +94771234567\" />\r\n        {phoneSent && (\r\n          <>\r\n            <label className=\"form-label\">SMS Code</label>\r\n            <input type=\"text\" className=\"form-control mb-2\" value={phoneCode} onChange={e=>setPhoneCode(e.target.value)} maxLength={6} />\r\n          </>\r\n        )}\r\n        {!phoneSent ? (\r\n          <button className=\"btn btn-primary\" onClick={sendPhoneCode} disabled={!phone}>Send Code</button>\r\n        ) : (\r\n          <button className=\"btn btn-success\" onClick={verifyPhone} disabled={phoneCode.length!==6}>Verify Phone</button>\r\n        )}\r\n      </div>\r\n\r\n      <button className=\"btn btn-link mt-3\" onClick={skip}>Skip for now</button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TwoFactor;\r\n"],"names":["navigate","useNavigate","phone","setPhone","useState","phoneSent","setPhoneSent","phoneCode","setPhoneCode","phoneVerified","setPhoneVerified","msg","setMsg","useEffect","onKey","e","key","length","verifyPhone","sendPhoneCode","window","addEventListener","removeEventListener","async","api","patch","post","err","_err$response","_err$response$data","console","error","response","data","code","_err$response2","_err$response2$data","_jsxs","className","style","maxWidth","children","_jsx","type","value","onChange","target","placeholder","_Fragment","maxLength","onClick","disabled"],"sourceRoot":""}